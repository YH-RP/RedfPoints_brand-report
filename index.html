<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Red Points 2026 ç›£æ§å ±å‘Š</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary: #c0565b; --primary-bg: #fff1f2; --secondary: #475569;
            --bg: #f8fafc; --card-bg: #ffffff; --text-main: #334155; --text-light: #94a3b8;
        }
        body { font-family: 'Noto Sans TC', sans-serif; background: var(--bg); color: var(--text-main); margin: 0; padding: 40px 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header-section { display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 1px solid #e2e8f0; }
        .header-title h1 { margin: 0; font-size: 28px; font-weight: 700; color: var(--secondary); letter-spacing: 1px; }
        .header-title span { font-size: 14px; color: var(--text-light); margin-top: 5px; display: block;}
        .upload-area { display: flex; gap: 10px; }
        .style-select { padding: 8px; border: 1px solid #cbd5e1; border-radius: 8px; }
        .btn-upload { background: var(--primary); color: white; padding: 8px 20px; border-radius: 50px; cursor: pointer; border: none; transition: 0.3s; }
        .btn-upload:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(192, 86, 91, 0.2); }
        #csvInput { display: none; }
        .section-box { margin-bottom: 40px; }
        .section-header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .section-title { font-size: 18px; color: var(--secondary); font-weight: 700; display: flex; align-items: center; gap: 8px; }
        .section-title::before { content: ''; width: 4px; height: 18px; background: var(--primary); border-radius: 2px; }
        .month-selector { padding: 5px 15px; border-radius: 20px; border: 1px solid var(--primary); color: var(--primary); background: white; cursor: pointer; font-weight: bold; }
        .kpi-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 15px; margin-bottom: 20px; }
        .kpi-card { background: white; padding: 20px; border-radius: 12px; text-align: center; border: 1px solid #f1f5f9; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .kpi-num { font-size: 28px; font-weight: 700; color: var(--primary); font-family: 'Roboto', sans-serif; }
        .kpi-label { font-size: 13px; color: var(--text-light); margin-bottom: 4px; }
        .comparison-table-container { background: white; border-radius: 12px; padding: 20px; border: 1px solid #f1f5f9; overflow-x: auto; }
        .comp-table { width: 100%; border-collapse: collapse; font-size: 12px; text-align: center; min-width: 1000px; }
        .comp-table th { background: #e2e8f0; color: #475569; padding: 8px 4px; border: 1px solid #cbd5e1; font-weight: 700; }
        .comp-table td { padding: 8px 4px; border: 1px solid #e2e8f0; }
        .comp-header-main { background: #94a3b8 !important; color: white !important; }
        .growth-neg { color: #94a3b8; } .growth-pos { color: #c0565b; font-weight: bold; }
        .insight-card { background: linear-gradient(135deg, #fff 0%, #fffafa 100%); border-left: 5px solid var(--primary); border-radius: 12px; padding: 20px 25px; margin-bottom: 30px; border: 1px solid #f1f5f9; }
        .insight-title { font-size: 15px; font-weight: 700; color: var(--primary); margin-bottom: 10px; }
        .insight-content { font-size: 15px; line-height: 1.8; color: var(--secondary); }
        .highlight-num { font-weight: 700; color: #e76f51; background: #fff1f2; padding: 0 4px; border-radius: 4px; }
        .highlight-text { font-weight: 700; color: #264653; }
        .split-layout { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .chart-card { background: white; border-radius: 16px; padding: 20px; height: 320px; border: 1px solid #f1f5f9; }
        .assets-container { background: white; border-radius: 16px; padding: 25px; border: 1px solid #f1f5f9; }
        .chart-area { height: 320px; margin-bottom: 20px; }
        .custom-table { width: 100%; border-collapse: collapse; font-size: 14px; }
        .custom-table th { text-align: left; padding: 10px; color: #64748b; border-bottom: 2px solid #f1f5f9; }
        .custom-table td { padding: 10px; border-bottom: 1px solid #f8fafc; }
        .ytd-col { font-weight: bold; color: var(--primary); background: #fffafa; }
        .footer-link-section { margin-top: 60px; padding-top: 30px; border-top: 1px solid #e2e8f0; text-align: center; padding-bottom: 40px; }
        .footer-btn-group { display: flex; justify-content: center; gap: 20px; }
        .external-link-btn { display: inline-flex; align-items: center; gap: 8px; background: #475569; color: white; padding: 12px 24px; border-radius: 12px; text-decoration: none; font-size: 14px; transition: 0.3s; }
        .external-link-btn:hover { background: #334155; transform: translateY(-2px); }
        .external-link-btn.secondary { background: white; color: #475569; border: 1px solid #cbd5e1; }
        @media (max-width: 900px) { .kpi-grid { grid-template-columns: 1fr 1fr; } .split-layout { grid-template-columns: 1fr; } }
    </style>
</head>
<body>
<div class="container">
    <div class="header-section">
        <div class="header-title"><h1>Red Points Report</h1><span id="statusText">è«‹åŒ¯å…¥ 2025-2026 æˆæ•ˆæ¯”è¼ƒå ±è¡¨</span></div>
        <div class="upload-area">
            <select id="encodingSelect" class="style-select"><option value="UTF-8">UTF-8</option><option value="Big5">Big5</option></select>
            <label for="csvInput" class="btn-upload">ï¼‹ åŒ¯å…¥æª”æ¡ˆ</label><input type="file" id="csvInput" accept=".csv" />
        </div>
    </div>

    <div class="section-box">
        <div class="section-header-row"><div class="section-title">1. é—œéµæŒ‡æ¨™ (KPI)</div><select id="monthSelect" class="month-selector" style="display:none;"></select></div>
        <div class="kpi-grid">
            <div class="kpi-card"><div class="kpi-label">åµæ¸¬æ•¸é‡ (2026)</div><div class="kpi-num" id="kpi-detect">-</div></div>
            <div class="kpi-card"><div class="kpi-label">æˆåŠŸä¸‹æ¶ (2026)</div><div class="kpi-num" id="kpi-remove">-</div></div>
            <div class="kpi-card"><div class="kpi-label">ä¸å¯åŸ·è¡Œ (2026)</div><div class="kpi-num" id="kpi-unable">-</div></div>
            <div class="kpi-card"><div class="kpi-label">åŸ·è¡ŒæˆåŠŸç‡ (2026)</div><div class="kpi-num" id="kpi-rate">-</div></div>
            <div class="kpi-card"><div class="kpi-label">ç¶“æ¿Ÿå½±éŸ¿ (NTD è¬å…ƒ)</div><div class="kpi-num" id="kpi-impact">-</div></div>
        </div>
        <div class="comparison-table-container" id="compTableBox" style="display:none;">
            <table class="comp-table">
                <thead>
                    <tr><th rowspan="2" class="comp-header-main">æœˆä»½</th><th colspan="3">åµæ¸¬æ•¸é‡</th><th colspan="2">æˆåŠŸä¸‹æ¶</th><th colspan="3">ä¸å¯åŸ·è¡Œ</th><th colspan="2">åŸ·è¡ŒæˆåŠŸç‡(%)</th><th colspan="3">ç¶“æ¿Ÿå½±éŸ¿ (NTD è¬å…ƒ)</th></tr>
                    <tr><th>2025</th><th>2026</th><th>æˆé•·ç‡</th><th>2025</th><th>2026</th><th>2025</th><th>2026</th><th>æˆé•·ç‡</th><th>2025</th><th>2026</th><th>2025</th><th>2026</th><th>æˆé•·ç‡</th></tr>
                </thead>
                <tbody id="compTableBody"></tbody>
            </table>
        </div>
    </div>

    <div id="insightSection" class="section-box" style="display:none;"><div class="insight-card"><div class="insight-title">ğŸ’¡ <span id="insightMonthTitle">æœ¬æœˆè§€å¯Ÿé‡é»</span></div><div class="insight-content" id="insightContent">è¨ˆç®—ä¸­...</div></div></div>

    <div class="split-layout">
        <div class="section-box" style="margin:0;"><div class="section-title">2. ä¿è­·é¡å‹åˆ†ä½ˆ</div><div class="chart-card"><canvas id="typeChart"></canvas></div></div>
        <div class="section-box" style="margin:0;"><div class="section-title">3. é«˜é¢¨éšªç¶²åŸŸæ’è¡Œ</div><div class="chart-card"><canvas id="domainChart"></canvas></div></div>
    </div>

    <div class="section-box" style="margin-top: 40px;">
        <div class="section-title">4. ä¾µæ¬Šè³‡ç”¢åˆ†æ (è¶¨å‹¢èˆ‡æ˜ç´°)</div>
        <div class="assets-container"><div class="chart-area"><canvas id="assetsChart"></canvas></div><table class="custom-table" id="assetTable"><thead><tr id="assetTableHeader"><th>è³‡ç”¢åç¨±</th></tr></thead><tbody id="assetTableBody"></tbody></table></div>
    </div>

    <div class="section-box">
        <div class="section-title">5. åŸ·è¡Œæ•ˆèƒ½è¶¨å‹¢ (å¹´åº¦èµ°å‹¢)</div>
        <div class="split-layout">
            <div class="chart-card"><div style="font-size:14px; font-weight:bold; margin-bottom:10px; color:var(--secondary);">åµæ¸¬èˆ‡ä¸‹æ¶é‡èµ°å‹¢ (2026)</div><canvas id="trendChart"></canvas></div>
            <div class="chart-card"><div style="font-size:14px; font-weight:bold; margin-bottom:10px; color:var(--secondary);">åŸ·è¡ŒæˆåŠŸç‡è¶¨å‹¢ (2026 %)</div><canvas id="rateTrendChart"></canvas></div>
        </div>
    </div>

    <div class="footer-link-section"><div class="footer-btn-group"><a href="https://redpoints-dash-rherhkqf.manus.space/" target="_blank" class="external-link-btn">ğŸ“Š Red Points 2025</a><a href="https://yh-rp.github.io/red-points-intro/" target="_blank" class="external-link-btn secondary">ğŸ“– Red Points ç¶²åŸŸåŠæµç¨‹</a></div></div>
</div>

<script>
    Chart.register(ChartDataLabels); Chart.defaults.font.family = "'Noto Sans TC', sans-serif";
    const pastelColors = ['#c0565b', '#2a9d8f', '#e9c46a', '#264653', '#f4a261', '#8ab17d'];
    const months = ['1æœˆ','2æœˆ','3æœˆ','4æœˆ','5æœˆ','6æœˆ','7æœˆ','8æœˆ','9æœˆ','10æœˆ','11æœˆ','12æœˆ'];
    let globalData = null; let charts = {};

    document.getElementById('csvInput').addEventListener('change', function(e) {
        const file = e.target.files[0]; if(!file) return;
        const reader = new FileReader();
        reader.onload = (e) => { 
            try { 
                const data = parseCSV(e.target.result); 
                updateDashboard(data, file.name); 
            } catch(err) { 
                console.error(err); alert("åŒ¯å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ CSV æ ¼å¼"); 
            } 
        };
        reader.readAsText(file, document.getElementById('encodingSelect').value);
        this.value = '';
    });

    document.getElementById('monthSelect').addEventListener('change', (e) => {
        if(globalData) { const idx = parseInt(e.target.value); renderKPI(globalData, idx); generateInsights(globalData, idx); renderCharts(globalData, idx); }
    });

    function splitCSVLine(line) {
        const result = []; let current = ''; let inQuotes = false;
        for (let char of line) { if (char === '"') inQuotes = !inQuotes; else if (char === ',' && !inQuotes) { result.push(current.trim()); current = ''; } else current += char; }
        result.push(current.trim()); return result;
    }

    function parseCSV(csvText) {
        const lines = csvText.split(/\r\n|\n/); let section = null;
        let data = { 
            detected2025:Array(12).fill(0), detected2026:Array(12).fill(0), 
            removed2025:Array(12).fill(0), removed2026:Array(12).fill(0), 
            unable2025:Array(12).fill(0), unable2026:Array(12).fill(0), 
            rate2025:Array(12).fill(0), rate2026:Array(12).fill(0), 
            impact2025:Array(12).fill(0), impact2026:Array(12).fill(0), 
            assets:{}, types:{}, 
            // ä¿®æ”¹ï¼šdomains æ”¹ç‚ºé™£åˆ—çš„é™£åˆ—ï¼Œæ¯å€‹ç´¢å¼•å°æ‡‰ä¸€å€‹æœˆ
            domains: Array(12).fill(null).map(() => [])
        };
        const clean = (v) => { if(!v || v==='-' || v.trim()==='' || v===' - ') return 0; let n = parseFloat(v.replace(/%/g,'').replace(/,/g,'').replace(/"/g,'')); return isNaN(n)?0:n; };

        lines.forEach(line => {
            if(!line.trim()) return; const cols = splitCSVLine(line);
            
            if (cols[0].includes("æŒ‡æ¨™é …ç›®") && cols[1].includes("1æœˆ")) { section = "2026"; return; }
            if (cols[0].includes("æŒ‡æ¨™é …ç›®") && (cols[1].includes("Jan-25") || cols[1].includes("2025"))) { section = "2025"; return; }
            if (line.includes("ä¾µæ¬Šè³‡ç”¢")) { section = "Assets"; return; }
            if (line.includes("ä¿è­·é¡å‹")) { section = "Types"; return; }
            if (line.includes("ç¶²åŸŸæ´»å‹•æ’è¡Œ")) { section = "Domains"; return; }

            if (section === "2026") {
                if (cols[0].includes("åµæ¸¬æ•¸é‡")) data.detected2026 = cols.slice(1,13).map(clean);
                if (cols[0].includes("æˆåŠŸä¸‹æ¶")) data.removed2026 = cols.slice(1,13).map(clean);
                if (cols[0].includes("ä¸å¯åŸ·è¡Œ")) data.unable2026 = cols.slice(1,13).map(clean);
                if (cols[0].includes("åŸ·è¡ŒæˆåŠŸç‡")) data.rate2026 = cols.slice(1,13).map(clean);
                if (cols[0].includes("ç¶“æ¿Ÿå½±éŸ¿")) data.impact2026 = cols.slice(1,13).map(clean);
            }
            else if (section === "2025") {
                if (cols[0].includes("åµæ¸¬æ•¸é‡")) data.detected2025 = cols.slice(1,13).map(clean);
                if (cols[0].includes("æˆåŠŸä¸‹æ¶")) data.removed2025 = cols.slice(1,13).map(clean);
                if (cols[0].includes("ä¸å¯åŸ·è¡Œ")) data.unable2025 = cols.slice(1,13).map(clean);
                if (cols[0].includes("åŸ·è¡ŒæˆåŠŸç‡")) data.rate2025 = cols.slice(1,13).map(clean);
                if (cols[0].includes("ç¶“æ¿Ÿå½±éŸ¿")) data.impact2025 = cols.slice(1,13).map(clean);
            }
            else if (section === "Assets" && !line.includes("åˆè¨ˆ") && cols[0].length > 2) {
                data.assets[cols[0].trim()] = cols.slice(1, 13).map(clean);
            } 
            else if (section === "Types" && (cols[0].trim().includes("Counterfeit") || cols[0].trim().includes("Brand abuse"))) {
                data.types[cols[0].trim()] = cols.slice(1, 13).map(clean);
            } 
            // ä¿®æ­£ï¼šç¶²åŸŸè§£æï¼Œæƒæç¬¬ 1-12 æ¬„ (ç´¢å¼• 1-12)
            else if (section === "Domains") {
                for (let i = 1; i <= 12; i++) {
                    if (cols[i] && cols[i].includes("(")) {
                        const m = cols[i].match(/(.*) \((\d+)\)/);
                        if (m) {
                            data.domains[i-1].push({ name: m[1].trim(), val: parseInt(m[2]) });
                        }
                    }
                }
            }
        });
        return data;
    }

    function updateDashboard(data, filename) {
        globalData = data; let indices = [];
        data.detected2026.forEach((v, i) => { if(v !== 0 || data.detected2025[i] !== 0) indices.push(i); });
        if(indices.length === 0) indices = [0];
        const lastIdx = indices[indices.length - 1];
        
        document.getElementById('statusText').textContent = `ä¾†æº: ${filename} (è‡³ ${months[lastIdx]})`;
        const sel = document.getElementById('monthSelect'); sel.innerHTML = '';
        indices.forEach(i => { let opt = document.createElement('option'); opt.value = i; opt.text = months[i]; sel.appendChild(opt); });
        sel.value = lastIdx; sel.style.display = 'block';
        renderComparisonTable(data, lastIdx); renderKPI(data, lastIdx); generateInsights(data, lastIdx); renderAssetTable(data, lastIdx); renderCharts(data, lastIdx);
    }

    function renderComparisonTable(data, lastIdx) {
        document.getElementById('compTableBox').style.display = 'block';
        const tbody = document.getElementById('compTableBody'); tbody.innerHTML = '';
        const calcGrowth = (v26, v25) => { if (!v25 || v25 === 0) return v26 > 0 ? '+100%' : '-'; let res = Math.round(((v26 - v25) / v25) * 100); return (res >= 0 ? '+' : '') + res + '%'; };
        for (let i = 0; i <= lastIdx; i++) {
            tbody.innerHTML += `<tr><td style="background:#f8fafc; font-weight:bold;">${i + 1}</td>
                <td>${data.detected2025[i].toLocaleString()}</td><td>${data.detected2026[i].toLocaleString()}</td><td class="${data.detected2026[i] < data.detected2025[i] ? 'growth-neg' : 'growth-pos'}">${calcGrowth(data.detected2026[i], data.detected2025[i])}</td>
                <td>${data.removed2025[i].toLocaleString()}</td><td>${data.removed2026[i].toLocaleString()}</td>
                <td>${data.unable2025[i].toLocaleString()}</td><td>${data.unable2026[i].toLocaleString()}</td><td class="${data.unable2026[i] < data.unable2025[i] ? 'growth-neg' : 'growth-pos'}">${calcGrowth(data.unable2026[i], data.unable2025[i])}</td>
                <td>${data.rate2025[i].toFixed(1)}%</td><td>${data.rate2026[i].toFixed(1)}%</td>
                <td>${data.impact2025[i].toLocaleString()}</td><td>${data.impact2026[i].toLocaleString()}</td><td class="${data.impact2026[i] < data.impact2025[i] ? 'growth-neg' : 'growth-pos'}">${calcGrowth(data.impact2026[i], data.impact2025[i])}</td></tr>`;
        }
    }

    function renderKPI(data, idx) {
        document.getElementById('kpi-detect').textContent = data.detected2026[idx].toLocaleString();
        document.getElementById('kpi-remove').textContent = data.removed2026[idx].toLocaleString();
        document.getElementById('kpi-unable').textContent = data.unable2026[idx].toLocaleString();
        document.getElementById('kpi-rate').textContent = data.rate2026[idx].toFixed(1) + "%";
        document.getElementById('kpi-impact').textContent = data.impact2026[idx].toLocaleString();
    }

    function generateInsights(data, idx) {
        try {
            document.getElementById('insightSection').style.display = 'block';
            document.getElementById('insightMonthTitle').textContent = `ã€æœ¬æœˆè§€å¯Ÿé‡é» - ${months[idx]}ã€‘`;
            document.getElementById('insightContent').textContent = 'è¨ˆç®—ä¸­...';

            let assetList = Object.entries(data.assets).map(([n, v]) => ({ name: n, val: v[idx] || 0 })).sort((a,b) => b.val - a.val);
            const top1 = assetList[0] || { name: 'ç„¡', val: 0 }; const top2 = assetList[1] || { name: 'ç„¡', val: 0 };
            
            let cKey = Object.keys(data.types).find(k => k.includes("Counterfeit")) || "Counterfeit";
            let aKey = Object.keys(data.types).find(k => k.includes("Brand abuse")) || "Brand abuse";
            let cCount = (data.types[cKey] || Array(12).fill(0))[idx] || 0;
            let aCount = (data.types[aKey] || Array(12).fill(0))[idx] || 0;
            
            let total = cCount + aCount; let pct = total > 0 ? ((cCount / total) * 100).toFixed(1) : 0;
            document.getElementById('insightContent').innerHTML = `<span class="highlight-text">"${top1.name}"</span> èˆ‡ <span class="highlight-text">"${top2.name}"</span> ä»ç‚ºä¸»è¦ä¾µæ¬Šå°è±¡ï¼Œåˆ†åˆ¥é” <span class="highlight-num">${top1.val.toLocaleString()}</span> ä»¶ èˆ‡ <span class="highlight-num">${top2.val.toLocaleString()}</span> ä»¶ã€‚<br>å‡è²¨ (Counterfeit) ä»ä½”çµ•å¤§å¤šæ•¸ <span class="highlight-num">${cCount.toLocaleString()}</span> ä»¶ (â‰ˆ <span class="highlight-num">${pct}%</span>)ï¼Œå“ç‰Œæ¿«ç”¨ (Brand abuse) æ•¸é‡æ¥µå°‘ (åƒ… <span class="highlight-num">${aCount.toLocaleString()}</span> ä»¶)ã€‚`;
        } catch(e) { console.error("Insight Error:", e); document.getElementById('insightContent').textContent = "ç„¡æ³•è¨ˆç®—æœ¬æœˆé‡é» (æ•¸æ“šä¸è¶³)"; }
    }

    function renderAssetTable(data, lastIdx) {
        const thead = document.getElementById('assetTableHeader'); const tbody = document.getElementById('assetTableBody');
        thead.innerHTML = `<th>è³‡ç”¢åç¨±</th>` + months.slice(0, lastIdx+1).map(m => `<th>${m}</th>`).join('') + `<th class="ytd-col">YTD ç¸½è¨ˆ</th>`;
        tbody.innerHTML = Object.entries(data.assets).map(([name, vals]) => {
            let sum = vals.slice(0, lastIdx+1).reduce((a, b) => a + b, 0);
            return `<tr><td>${name}</td>` + vals.slice(0, lastIdx+1).map(v => `<td>${v.toLocaleString()}</td>`).join('') + `<td class="ytd-col">${sum.toLocaleString()}</td></tr>`;
        }).join('');
    }

    function renderCharts(data, lastIdx) {
        const labels = months.slice(0, lastIdx + 1);
        if(charts.trend) charts.trend.destroy();
        charts.trend = new Chart(document.getElementById('trendChart'), {
            type: 'line', data: { labels: labels, datasets: [
                { label: 'æˆåŠŸä¸‹æ¶', data: data.removed2026.slice(0, lastIdx+1), borderColor: '#c0565b', backgroundColor: '#c0565b', tension: 0.3, borderWidth: 3, pointRadius: 5, datalabels: { align: 'top', anchor: 'end', color: '#c0565b', offset: 4 } },
                { label: 'åµæ¸¬æ•¸é‡', data: data.detected2026.slice(0, lastIdx+1), borderColor: '#94a3b8', backgroundColor: '#94a3b8', borderDash: [5, 5], tension: 0.3, borderWidth: 2, pointRadius: 5, datalabels: { align: 'bottom', anchor: 'start', color: '#475569', offset: 4 } }
            ]}, options: { responsive: true, maintainAspectRatio: false, layout: { padding: { top: 25, bottom: 25 } }, plugins: { legend: { position: 'bottom' }, datalabels: { font: { weight: 'bold', size: 11 }, formatter: (v) => v.toLocaleString() } } }
        });
        if(charts.rateTrend) charts.rateTrend.destroy();
        const rateData = data.rate2026.slice(0, lastIdx+1);
        charts.rateTrend = new Chart(document.getElementById('rateTrendChart'), {
            type: 'line', data: { labels: labels, datasets: [{ label: 'æˆåŠŸç‡ %', data: rateData, borderColor: '#2a9d8f', backgroundColor: 'rgba(42, 157, 143, 0.1)', fill: true, tension: 0.3, pointRadius: 5, datalabels: { align: 'top', anchor: 'end', color: '#2a9d8f', formatter: v => v.toFixed(1)+'%' } }] },
            options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0, max: 130 } }, plugins: { legend: { display: false }, datalabels: { font: { weight: 'bold' } } } }
        });
        if(charts.types) charts.types.destroy();
        let cKey = Object.keys(data.types).find(k => k.includes("Counterfeit")) || "Counterfeit";
        let aKey = Object.keys(data.types).find(k => k.includes("Brand abuse")) || "Brand abuse";
        let cVal = (data.types[cKey] || [])[lastIdx] || 0;
        let aVal = (data.types[aKey] || [])[lastIdx] || 0;
        charts.types = new Chart(document.getElementById('typeChart'), {
            type: 'doughnut', data: { labels: ["Counterfeit", "Brand abuse"], datasets: [{ data: [cVal, aVal], backgroundColor: [pastelColors[0], '#cbd5e1'], borderWidth: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { datalabels: { display: false }, legend: { position: 'right' } } }
        });
        if(charts.domain) charts.domain.destroy();
        // ä¿®æ­£ï¼šå‹•æ…‹è®€å–è©²æœˆä»½çš„ç¶²åŸŸæ’è¡Œ
        const currentMonthDomains = data.domains[lastIdx] || [];
        charts.domain = new Chart(document.getElementById('domainChart'), {
            type: 'bar', data: { labels: currentMonthDomains.map(d => d.name), datasets: [{ data: currentMonthDomains.map(d => d.val), backgroundColor: '#264653', borderRadius: 6 }] },
            options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { datalabels: { display: false }, legend: { display: false } } }
        });
        if(charts.assets) charts.assets.destroy();
        charts.assets = new Chart(document.getElementById('assetsChart'), {
            type: 'bar', data: { labels: labels, datasets: Object.entries(data.assets).map(([k, v], i) => ({ label: k, data: v.slice(0, lastIdx+1), backgroundColor: pastelColors[i % pastelColors.length], borderRadius: 4 })) },
            options: { responsive: true, maintainAspectRatio: false, scales: { x:{stacked:true}, y:{stacked:true} }, plugins: { datalabels: { display: false } } }
        });
    }
</script>
</body>
</html>
